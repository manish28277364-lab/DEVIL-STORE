<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DEVIL STORE</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{margin:0;background:#000;color:#0f0;font-family:Arial}
header{background:#111;padding:12px;display:flex;justify-content:space-between;align-items:center}
button{background:#0f0;color:#000;border:none;padding:7px 12px;border-radius:6px;margin:3px}
input,select{width:100%;padding:7px;margin:5px 0;background:#000;border:1px solid #0f0;color:#0f0}
.app{border:1px solid #0f0;margin:10px;padding:10px;border-radius:10px;display:flex;gap:10px}
.app img{width:60px;height:60px;border-radius:10px;object-fit:cover}
.hidden{display:none}
.star{color:gold}
small{color:#9f9}
</style>
</head>

<body>

<header>
<b>üòà DEVIL STORE</b>
<div>
<button onclick="userMode()">USER</button>
<button onclick="adminLogin()">ADMIN</button>
</div>
</header>

<div style="padding:10px">
<input id="search" placeholder="Search apps..." oninput="render()">

<div>
<button onclick="setCat('All')">All</button>
<button onclick="setCat('Games')">Games</button>
<button onclick="setCat('Apps')">Apps</button>
<button onclick="setCat('Tools')">Tools</button>
<button onclick="setCat('Mods')">Mods</button>
</div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden" style="padding:10px;border-top:2px solid #0f0">
<h3>ADMIN PANEL</h3>

<input id="name" placeholder="App Name">
<input id="icon" placeholder="Icon Image URL">
<input id="manualLink" placeholder="Manual Download Link (optional)">
<input type="file" id="file">

<select id="cat">
<option>Games</option>
<option>Apps</option>
<option>Tools</option>
<option>Mods</option>
</select>

<select id="rating">
<option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
<option value="4">‚òÖ‚òÖ‚òÖ‚òÖ</option>
<option value="3">‚òÖ‚òÖ‚òÖ</option>
<option value="2">‚òÖ‚òÖ</option>
<option value="1">‚òÖ</option>
</select>

<button onclick="addApp()">ADD APP</button>
</div>

<div id="apps"></div>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey:"AIzaSyApZh6LLiR8NIVISOF49eMW0S9oAy0ETeY",
  databaseURL:"https://devil-mods-2-default-rtdb.firebaseio.com",
  storageBucket:"devil-mods-2.firebasestorage.app"
});

const db = firebase.database();
const storage = firebase.storage();

let isAdmin=false, apps={}, currentCat="All";

/* ADMIN / USER */
function adminLogin(){
  const p = prompt("Enter Admin Password");
  if(p==="DEVILPAPA"){
    isAdmin=true;
    adminPanel.classList.remove("hidden");
    render();
  } else alert("Wrong password");
}
function userMode(){
  isAdmin=false;
  adminPanel.classList.add("hidden");
  render();
}

/* ADD APP */
function addApp(){
  const name = document.getElementById("name").value.trim();
  const icon = document.getElementById("icon").value.trim();
  const manual = document.getElementById("manualLink").value.trim();
  const cat = document.getElementById("cat").value;
  const rating = document.getElementById("rating").value;
  const file = document.getElementById("file").files[0];

  if(!name || !icon){
    alert("Name & Icon URL required");
    return;
  }

  const id = db.ref("apps").push().key;

  if(file){
    const ref = storage.ref("apps/"+id+"_"+file.name);
    ref.put(file).then(snap=>{
      snap.ref.getDownloadURL().then(url=>{
        db.ref("apps/"+id).set({
          name, icon, cat, rating,
          link: manual || url,
          size: (file.size/1024/1024).toFixed(2)+" MB"
        });
      });
    });
  }else{
    db.ref("apps/"+id).set({
      name, icon, cat, rating,
      link: manual,
      size: "N/A"
    });
  }

  document.getElementById("name").value="";
  document.getElementById("icon").value="";
  document.getElementById("manualLink").value="";
  document.getElementById("file").value="";
}

/* DELETE (ADMIN ONLY) */
function del(id){
  if(!isAdmin) return;
  if(confirm("Delete app?")){
    db.ref("apps/"+id).remove();
  }
}

/* FILTERS */
function setCat(c){ currentCat=c; render(); }

/* RENDER */
function render(){
  const q = document.getElementById("search").value.toLowerCase();
  const box = document.getElementById("apps");
  box.innerHTML="";

  for(let id in apps){
    const a = apps[id];
    if(currentCat!=="All" && a.cat!==currentCat) continue;
    if(!a.name.toLowerCase().includes(q)) continue;

    box.innerHTML += `
    <div class="app">
      <img src="${a.icon}" onerror="this.src='https://i.imgur.com/6XGQZ7v.png'">
      <div>
        <b>${a.name}</b><br>
        <small>${a.cat} ‚Ä¢ ${a.size}</small><br>
        <span class="star">${"‚òÖ".repeat(a.rating)}</span><br>
        <a href="${a.link}" target="_blank"><button>Download</button></a>
        ${isAdmin?`<button onclick="del('${id}')">‚ùå</button>`:""}
      </div>
    </div>`;
  }
}

/* REALTIME SYNC */
db.ref("apps").on("value",snap=>{
  apps = snap.val() || {};
  render();
});
</script>

</body>
</html>
